The answer is to use a recording rule for the inner function, and then you can use the outer function on the time series it creates. You can add the path of a file to read rules from to your prometheus.yml: rule_files: - my_rules.rules . And put your rules in that file: